{
    "collab_server" : "",
    "contents" : "## \n# Takes ddply'd stats as input and Greedy Sorts nodes into a sequence.\n\nlibrary(plyr)\nsource(\"configuration.R\")\nsource(\"commonFunctions.R\")\n\n\nclosestNodeByDistance <- function(senderNode, currentSeq, lookinSet, constraint=\"d_from_mean\") {\n  lookinSet <- subset (lookinSet, sender==senderNode & !(receiver %in% currentSeq)) # lookinSet except currentSeq\n  orderedSet <- lookinSet[order(lookinSet[,constraint]),] # ordered by constraint, ascending\n  return(as.numeric(as.character(orderedSet[1,\"receiver\"])))\n}\n\nclosestNodeByRss <- function(senderNode, currentSeq, lookinSet, constraint=\"avg_rssi\") {\n  lookinSet <- subset (lookinSet, sender==senderNode & !(receiver %in% currentSeq)) # lookinSet except currentSeq\n  orderedSet <- lookinSet[order(-lookinSet[,constraint]),] # ordered by constraint, descending\n  return(as.numeric(as.character(orderedSet[1,\"receiver\"])))\n}\n\ngreedySortNodes <- function (refNode, Set, constraint = \"d_from_mean\", useRSS = TRUE) {\n  #cat(\"constraint:\",constraint,\" \");\n  resultSeq <- c(refNode)\n  while (length(resultSeq) != length(unique(Set$sender))) {\n    if (useRSS)\n      nextNode <- closestNodeByRss (resultSeq[length(resultSeq)],resultSeq, Set, constraint)\n    else\n      nextNode <- closestNodeByDistance (resultSeq[length(resultSeq)],resultSeq, Set, constraint)\n    resultSeq <- c(resultSeq,nextNode)\n  }\n  return(resultSeq)\n}\n\nallSequences_fromCh11 = matrix(data = NA, nrow = 1, ncol = length(Truth), byrow = TRUE, dimnames = NULL)\nallSequences_fromCh18 = matrix(data = NA, nrow = 1, ncol = length(Truth), byrow = TRUE, dimnames = NULL)\nallSequences_fromCh26 = matrix(data = NA, nrow = 1, ncol = length(Truth), byrow = TRUE, dimnames = NULL)\nallSequences_fromMean = matrix(data = NA, nrow = 1, ncol = length(Truth), byrow = TRUE, dimnames = NULL)\n\nsuccessCh11 <- 0\nsuccessCh18 <- 0\nsuccessCh26 <- 0\nsuccessMean <- 0\n\nstartTime <- proc.time()\n\nallstats <- read.csv (\"./inputs/distance_vector_stats_all_channels_4thFl-South-Window-nPacket.csv.txt\", header=TRUE);\n#Truth <- 10:1; refnode=10; \nexperimentSet <- unique(allstats$run)\n\nfor(expNo in experimentSet)\n{\n  cat(\"expNo:\",expNo,\"\\n\") \n  \n  stats <- subset (allstats, run==expNo & sender %in% Truth & receiver %in% Truth)\n  \n  #Ch11\n  {\n    theSequenceCh11 <- greedySortNodes(refnode, stats, constraint=\"avg_ch11_rssi_8packet\", useRSS=TRUE);\n    allSequences_fromCh11 <- rbind(allSequences_fromCh11,theSequenceCh11)\n    \n    verdict11 <- all(theSequenceCh11 == Truth)\n    if (verdict11 == TRUE){\n      successCh11 <- successCh11 + 1\n    }\n  }\n\n  #Ch18\n  {\n    theSequenceCh18 <- greedySortNodes(refnode, stats, constraint=\"avg_ch18_rssi_8packet\", useRSS=TRUE);\n    allSequences_fromCh18 <- rbind(allSequences_fromCh18,theSequenceCh18)\n    \n    verdict18 <- all(theSequenceCh18 == Truth)\n    if (verdict18 == TRUE){\n      successCh18 <- successCh18 + 1\n    }\n  }\n\n  #Ch26\n  {\n    theSequenceCh26 <- greedySortNodes(refnode, stats, constraint=\"avg_ch26_rssi_8packet\", useRSS=TRUE);\n    allSequences_fromCh26 <- rbind(allSequences_fromCh26,theSequenceCh26)\n    \n    verdict26 <- all(theSequenceCh26 == Truth)\n    if (verdict26 == TRUE){\n      successCh26 <- successCh26 + 1\n    }\n  }\n  \n  #Mean\n  {\n    theSequenceMean <- greedySortNodes(refnode, stats, constraint=\"avg_rssi_8packet\", useRSS=TRUE);\n    allSequences_fromMean <- rbind(allSequences_fromMean,theSequenceMean)\n    \n    verdictMean <- all(theSequenceMean == Truth)\n    if (verdictMean == TRUE){\n      successMean <- successMean + 1\n    }\n  }\n  cat(\"successCh11:\",successCh11,\"\\t\"); cat(\"successCh18:\",successCh18,\"\\t\");\n  cat(\"successCh26:\",successCh26,\"\\t\"); cat(\"successMean:\",successMean,\"\\n\")\n}\n\n## Print Elapsed Time\nendTime <- proc.time()\nprint(endTime-startTime)\n\nif (FALSE)\n{\n  allSequences_fromCh11 <- allSequences_fromCh11[2:nrow(allSequences_fromCh11),]\n  saveToFile(allSequences_fromCh11,filePrefix=\"allSequences_d_fromCh11\");\n  \n  allSequences_fromCh18 <- allSequences_fromCh18[2:nrow(allSequences_fromCh18),]\n  saveToFile(allSequences_fromCh18,filePrefix=\"allSequences_d_fromCh18\");\n  \n  allSequences_fromCh26 <- allSequences_fromCh26[2:nrow(allSequences_fromCh26),]\n  saveToFile(allSequences_fromCh26,filePrefix=\"allSequences_d_fromCh26\");\n  \n  allSequences_fromMean <- allSequences_fromMean[2:nrow(allSequences_fromMean),]\n  saveToFile(allSequences_fromMean,filePrefix=\"allSequences_d_fromMean\");\n}\n\nif (FALSE) {\n            TRACE_FILE <- paste(directory,inFilePrefix,expNo,inFileSuffix, sep=\"\")\n            \n            cat(\"Loading:\",TRACE_FILE,\"\\n\")  \n            packets <- read.table(TRACE_FILE, sep=\"\\t\", na.strings=\"\", col.names=c(\"receiver\", \"sender\", \"channel\", \"rssi\", \"power\", \"time\", \"packetnum\"), \n                                  colClasses=c(rep(\"factor\",3), \"numeric\", \"factor\", \"character\", \"numeric\"), header=FALSE)\n            \n            stats <- ddply (packets,.(sender,receiver), summarise, \n                            mean_rssi = mean(rssi), \n                            mean_ch26_rssi = mean(subset(rssi,channel==26)),\n                            d_from_mean = d_from_rss(mean_rssi),\n                            d_from_ch26 = d_from_rss(mean_ch26_rssi)\n                            )\n}",
    "created" : 1400161254431.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1249903635",
    "id" : "D68C1248",
    "lastKnownWriteTime" : 1405686429,
    "last_content_update" : 0,
    "path" : "~/phd/R/AllScripts/Rss2Distance.R",
    "project_path" : "Rss2Distance.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 0,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}