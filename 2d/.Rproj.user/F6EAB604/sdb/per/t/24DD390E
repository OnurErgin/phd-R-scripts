{
    "collab_server" : "",
    "contents" : "# 28/05/2015\n\n######\n#ToDo: Try three candidates for refnode selection\n#      Find the limitations through RSS-curve, how right can one go on the curve, \n#        what RSS is still doable?\n#\n\nsource(\"EdgeDiscovery.R\")\n\ncols <- Nx <- 5; rows <- Ny <- 4; dx <- 3; dy <- 3; sd_noise_dbm <- -30\n\nexperimentSet <- 1:100 # 3x3fails: c(8, 16, 34, 54, 59, 83, 90) # 5x5fails: c(8, 34, 41, 59, 81, 83, 90)\nTruth <- matrix (c(0:(Nx*Ny-1)), nrow=Ny, byrow=TRUE)\nrefnodes <- c(Truth[1,1],Truth[Ny,1], Truth[1,Nx])\n\nnumnodes <- length(Truth)\n#directory <- paste(\"./simOut-\",Nx,\"x\",Ny,\"-\",dx,\"mX\",dy,\"m-Noise\",sd_noise_dbm,\"dbm/\",sep=\"\")\n#basedirectory <- \"inputs_simulation/equiDist/3x3_ideal/\"; subdirectory<-\"\"\nbasedirectory <- \"/Volumes/carme_lhome/R/2d/equiDist/\"\nsubdirectory <- paste(\"simOut-\",Nx,\"x\",Ny,\"-\",dx,\"mX\",dy,\"m-Noise\",sd_noise_dbm,\"dbm/\",sep=\"\")\nbasedirectory <- \"../measurements/simOut-5x4-3mX3m-Noise-30dbm/\"; subdirectory<-\"\"\ndirectory <- paste(basedirectory,subdirectory,sep=\"\")\n\npruneThreshold <- 2\nsource(\"probSeqFunctions-fixedPrune.R\")\n\ntopQuantile <- 0.5\nrssMaxDifference <- 3\n\nrun.verbose <- FALSE\nproduceOutput <- FALSE # for probabilitySeqDF and probabilitiesDF. This file will produce output anyways\n\nexpSize <- length(experimentSet)\nverdicts <- data.frame(expNo=numeric(expSize), verdict=logical(expSize), reliability=character(expSize), stringsAsFactors=FALSE)\nhighReliable <- mediumReliable <- lowReliable <- c()\ntotalSuccess <- 0\nfailedExpNos <- c()\nlostCandidateToCompetitor <- c()\nfor(expNo in experimentSet)\n{   \n  startTime <- proc.time()\n  \n  TRACE_FILE <- paste(directory,\"2dSim-\",Nx,\"x\",Ny,\"-\",dx,\"mX\",dy,\"m-\",expNo,\".txt\",sep=\"\")\n  cat(\"Loading:\",TRACE_FILE, \"\\n\")  \n  packets <- read.table(TRACE_FILE,  na.strings=\"\", header=TRUE)\n  packets$time  <- 0\n  packets$power <- 0\n  \n  firstColumn <- discoverEdge(refnodes[c(1,2)], packets, Ny)  \n  firstRow <- discoverEdge(refnodes[c(1,3)], packets, Nx, excluding = firstColumn)\n  \n  nrowsResult <- length(firstColumn); ncolsResult <- length(firstRow)\n  \n  result <- matrix(data=-1,nrow=nrowsResult, ncol=ncolsResult)\n  \n  result[,1] <- firstColumn\n  result[1,] <- firstRow\n  \n  # Row-by-row select the next node at each column\n  for (ci in 2:ncolsResult){ # for each column\n    for (ri in 1:nrowsResult){ # for each row; only odds: which(1:Ny %% 2 == 1)\n     # if (ci == 3) browser()\n      if (result[ri,ci] != -1) next;\n      winners <- getSendersWinningReceivers(allPackets=packets, theSender=result[ri,(ci-1)], excludeList = as.integer(result))\n      closestNode <- mostFreqReceiver(winners,tIndex=1)\n      if (is.null(closestNode)) \n        closestNode <- -1\n      #cat (closestNode, \"with P=\", findProbability(winners[1,], 1, length(winners[1,])),\"\\n\")\n      if (ri + 1 <= nrowsResult) { # if next row exists\n        #####\n        closestNodeP <- findProbabilityByName(winners[1,],name=closestNode)\n        secondClosestNode <- mostFreqReceiver(winners,tIndex=2)\n      \n        nextNodeWinners <- getSendersWinningReceivers(allPackets=packets, theSender=result[ri+1,(ci-1)], excludeSet <- as.integer(result))\n        closestNodeForNextNode <- mostFreqReceiver(nextNodeWinners,tIndex=1)\n        closestNodeForNextNodeP <- findProbabilityByName(nextNodeWinners[1,],name=closestNodeForNextNode)\n        \n        if (closestNodeForNextNode != closestNode) {\n          result[ri,ci] <- closestNode \n        }else \n        if (closestNodeForNextNode == closestNode) {\n          if (closestNodeP >= closestNodeForNextNodeP) {\n            result[ri,ci] <- closestNode \n          } else {\n            result[ri+1,ci] <- closestNodeForNextNode # ?= closestNode\n            # Select a new one\n            winners <- getSendersWinningReceivers(allPackets=packets, theSender=result[ri,(ci-1)], excludeSet <- as.integer(result))\n            closestNode <- mostFreqReceiver(winners,tIndex=1)\n            \n            if (is.null(closestNode)) \n              closestNode <- -1\n              \n              result[ri,ci] <- closestNode \n            \n            print(\"Lost candidate to Competitor\"); lostCandidateToCompetitor <- c(lostCandidateToCompetitor, expNo)\n          }\n        }\n        \n        #####\n      } else {\n        result[ri,ci] <- closestNode \n      } #if ...\n      \n    }\n  }\n  class(result) <- \"integer\"\n  print(result)\n  \n  if (all.equal(Truth,result) == TRUE) {\n    totalSuccess <- totalSuccess + 1\n    isSuccess <- TRUE\n  } else {\n    failedExpNos <- c(failedExpNos,expNo)\n    isSuccess <- FALSE\n  }\n  cat(\"Result is \", isSuccess, \"\\t total: \",totalSuccess, \"/\",length(failedExpNos)+totalSuccess, \"\\n\")\n  \n  ## Print Elapsed Time\n  endTime <- proc.time()\n  print(endTime-startTime)\n\n  if (TRUE) {\n  ## Reliability\n    score <- 0\n    # First column reverse:\n    revRefNodeSet <- discoverEdge(rev(refnodes[c(1,2)]),packets, Ny)\n    if (TRUE == all.equal(rev(firstColumn),revRefNodeSet)) {\n      print(\"First column matches\")\n      score <- score + 1\n    }\n    \n    if (-1 %in% result) {\n      score <- 0\n      } else { cols <- ncolsResult ; rows <- nrowsResult\n        \n        lastColumn <- result[,cols]\n        \n        lastColumnRefnodes <- c(result[1,cols], result[rows,cols])\n        lastColumnRefnodeset <- discoverEdge(lastColumnRefnodes, packets, Ny)\n        reverseLastColumnRefnodeset <- discoverEdge(rev(lastColumnRefnodes), packets, Ny)\n          \n        if (TRUE == all.equal(as.integer(lastColumnRefnodeset),lastColumn) || \n              TRUE == all.equal(as.integer(reverseLastColumnRefnodeset),lastColumn) ){\n            print(\"Last column matches\")\n            score <- score + 1\n            \n            if (TRUE == all.equal(lastColumnRefnodeset,rev(reverseLastColumnRefnodeset)))\n              score <- score + 1\n        }\n      }\n    \n    if (score == 3)\n    {\n      highReliable <- c( highReliable , expNo)\n      cat(\"ExpNo:\",expNo,\" reliability is: High!\\n\")\n      reliability <- \"high\"\n    } else if (score == 2){\n      mediumReliable <- c(mediumReliable, expNo)\n      cat(\"ExpNo:\",expNo,\" reliability is: Medium!\\n\")\n      reliability <- \"medium\"\n    } else {\n      lowReliable <- c(lowReliable, expNo)\n      cat(\"ExpNo:\",expNo,\" reliability is: Low!\\n\")\n      reliability <- \"low\"\n    }\n  }\n  \n  verdicts[expNo,\"expNo\"] <- expNo\n  verdicts[expNo,\"verdict\"] <- isSuccess\n  verdicts[expNo,\"reliability\"] <- reliability\n  print(tail(verdicts[verdicts$expNo!=0,],n=1))\n  ## Reliability:\n  #First column (fc) ref nodes match reverse (rfc)\n  #Last column(lc) in refnode check = lr\n  #Last column reverse refnode check = lrr\n  #Lastcolumn in lr or lrr\n  \n  # if (fc == rfc && lc %in% c(lr,lrr))\n  #   if (lr==lrr) then high\n  #   else medium\n  # 3 comparisons. 3 matches = high, 2 matches = medium, less matches = low reliablity\n  #   1: fc == rfc\n  #   2: lc %in% c(lr,lrr)\n  #   3: lr==lrr\n  \n  \n} # for expNo\n\ncat(\"totalSuccess=\",totalSuccess,\"/\",length(experimentSet) ,\"\\n\")\ncat(\"High Reliable = \", length(highReliable), \"\\n\")\ncat(\"Medium Reliable = \", length(mediumReliable), \"\\n\")\ncat(\"Low Reliable = \", length(lowReliable), \"\\n\")\n\nif(FALSE)\n{\n  outfile <- paste(basedirectory,\"verdict-\",Nx,\"x\",Ny,\"-\",dx,\"mX\",dy,\"m-Noise\",sd_noise_dbm,\"dbm.txt\",sep=\"\")\n  write.table(verdicts, file=outfile, sep=\" \", col.names=TRUE, row.names=FALSE)\n  cat(outfile, \" written.\\n\")\n}\n",
    "created" : 1427207045583.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "444444702",
    "id" : "24DD390E",
    "lastKnownWriteTime" : 1433076778,
    "last_content_update" : 0,
    "path" : "~/phd/R/2d/equiDistance2D_3RefNodes.R",
    "project_path" : "equiDistance2D_3RefNodes.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 19,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}